CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    migration_id character varying(150) NOT NULL,
    product_version character varying(32) NOT NULL,
    CONSTRAINT pk___ef_migrations_history PRIMARY KEY (migration_id)
);

START TRANSACTION;


DO $EF$
BEGIN
    IF NOT EXISTS(SELECT 1 FROM "__EFMigrationsHistory" WHERE "migration_id" = '20220117022054_InitialCreate') THEN
    CREATE TABLE devices (
        id integer GENERATED BY DEFAULT AS IDENTITY,
        name text NOT NULL,
        description text NOT NULL,
        CONSTRAINT pk_devices PRIMARY KEY (id)
    );
    END IF;
END $EF$;

DO $EF$
BEGIN
    IF NOT EXISTS(SELECT 1 FROM "__EFMigrationsHistory" WHERE "migration_id" = '20220117022054_InitialCreate') THEN
    INSERT INTO "__EFMigrationsHistory" (migration_id, product_version)
    VALUES ('20220117022054_InitialCreate', '6.0.1');
    END IF;
END $EF$;
COMMIT;

START TRANSACTION;


DO $EF$
BEGIN
    IF NOT EXISTS(SELECT 1 FROM "__EFMigrationsHistory" WHERE "migration_id" = '20220122101817_Telemetry') THEN
    CREATE TABLE telemetry (
        id integer GENERATED BY DEFAULT AS IDENTITY,
        device_id text NOT NULL,
        timestamp timestamp with time zone NOT NULL,
        temperature_c integer NOT NULL,
        battery_percent integer NOT NULL,
        disk_space_free integer NOT NULL,
        uptime_seconds integer NOT NULL,
        CONSTRAINT pk_telemetry PRIMARY KEY (id)
    );
    END IF;
END $EF$;

DO $EF$
BEGIN
    IF NOT EXISTS(SELECT 1 FROM "__EFMigrationsHistory" WHERE "migration_id" = '20220122101817_Telemetry') THEN
    INSERT INTO "__EFMigrationsHistory" (migration_id, product_version)
    VALUES ('20220122101817_Telemetry', '6.0.1');
    END IF;
END $EF$;
COMMIT;

